/*
	https://github.com/hi098123/Tistory_Comment
	License : MIT
	Version : 2020-04-28
*/
var hi098123_id,hi098123_id2,tistory_hi098123_comment=[],rps_finder=[],comment_refresh_num=0,Comment_option={link:!0,prevent_rp_del:!1,remove_report:!1,comment_urls:0,comment_urls_open:0},comment_history={node:"",code:""};function rplc_(e,r,t){return e.split(r).join(t)}function hi098123_comment(e,r){comment_history={node:e,code:r};var t=document.createElement("div"),_=document.createElement("div"),n=document.createElement("div");t.innerHTML=r,_.innerHTML=t.querySelector("s_rp2_container").innerHTML,t.querySelector("s_rp2_container").innerHTML="";for(var o=0;o<tistory_hi098123_comment.length;o++){var m=t.innerHTML,c=tistory_hi098123_comment[tistory_hi098123_comment[o]];if(m=rplc_(m,"[#_rp_rep_id_#]",tistory_hi098123_comment[o]),m=rplc_(m,"[#_rp_rep_logo_#]",c.logo),m=rplc_(m,"[#_rp_rep_class_#]",c.cls),Comment_option.link)m=rplc_(m,"[#_rp_rep_name_#]",c.name);else(l=document.createElement("a")).innerHTML=c.name,m=rplc_(m,"[#_rp_rep_name_#]",l.innerText);if(m=Comment_option.remove_report?rplc_(m,"[#_rp_rep_date_#]",c.date.split("<")[0]):rplc_(m,"[#_rp_rep_date_#]",c.date),isNaN(Comment_option.comment_urls))m=rplc_(m,"[#_rp_rep_desc_#]",urlfy(c.comm,Comment_option.comment_urls));else switch(Comment_option.comment_urls){case 1:m=rplc_(m,"[#_rp_rep_desc_#]",urlfy(c.comm,[TistoryBlog.url.split("/")[2],TistoryBlog.tistoryUrl.split("/")[2]]));break;case 2:m=rplc_(m,"[#_rp_rep_desc_#]",urlfy(c.comm,[]));break;case 0:default:m=rplc_(m,"[#_rp_rep_desc_#]",c.comm)}m=rplc_(m,"[#_rp_rep_onclick_delete_#]",(Comment_option.prevent_rp_del&&tistory_hi098123_comment[tistory_hi098123_comment[o]].rps.length?"S":"_")+c.delbtn),m=rplc_(m,"[#_rp_rep_onclick_reply_#]",c.repbtn);for(var i="",p=(c=tistory_hi098123_comment[tistory_hi098123_comment[o]].rps,0);p<c.length;p++){var l,s=_.innerHTML;if(s=rplc_(s,"[#_rp_rep_id_#]",c[p]),s=rplc_(s,"[#_rp_rep_logo_#]",c[c[p]].logo),s=rplc_(s,"[#_rp_rep_class_#]",c[c[p]].cls),Comment_option.link)s=rplc_(s,"[#_rp_rep_name_#]",c[c[p]].name);else(l=document.createElement("a")).innerHTML=c[c[p]].name,s=rplc_(s,"[#_rp_rep_name_#]",l.innerText);if(s=Comment_option.remove_report?rplc_(s,"[#_rp_rep_date_#]",c[c[p]].date.split("<")[0]):rplc_(s,"[#_rp_rep_date_#]",c[c[p]].date),isNaN(Comment_option.comment_urls))s=rplc_(s,"[#_rp_rep_desc_#]",urlfy(c[c[p]].comm,Comment_option.comment_urls));else switch(Comment_option.comment_urls){case 1:s=rplc_(s,"[#_rp_rep_desc_#]",urlfy(c[c[p]].comm,[TistoryBlog.url.split("/")[2],TistoryBlog.tistoryUrl.split("/")[2]]));break;case 2:s=rplc_(s,"[#_rp_rep_desc_#]",urlfy(c[c[p]].comm,[]));break;case 0:default:s=rplc_(s,"[#_rp_rep_desc_#]",c[c[p]].comm)}s=rplc_(s,"[#_rp_rep_onclick_delete_#]",(Comment_option.prevent_rp_del&&p<c.length-1?"S":"_")+c[c[p]].delbtn),s=rplc_(s,"<s_rp2_rep>",""),i+=s=rplc_(s,"</s_rp2_rep>","")}n.innerHTML+=m,n.querySelector("s_rp2_container").outerHTML=i}n.innerHTML=rplc_(n.innerHTML,"<s_rp_rep>",""),n.innerHTML=rplc_(n.innerHTML,"</s_rp_rep>","");var a=document.querySelector(".tt_more_preview_comments_wrap")||"";""!=a&&(-1==a.getAttribute("onclick").indexOf("_getEntryCommentsByPaging")&&a.setAttribute("onclick",rplc_(a.getAttribute("onclick"),"getEntryCommentsByPaging","_getEntryCommentsByPaging")),a=a.outerHTML),document.querySelector(e).innerHTML=a+n.innerHTML,hi098123_id=void 0,hi098123_id2=void 0}function SdeleteComment(){alert(decodeURIComponent(escape(atob("64u16riA7J20IOyeiOuKlCDrjJPquIDsnYAg7IiY7KCVL+yCreygnO2VoCDsiJgg7JeG7Iq164uI64ukLg=="))))}
function urlfy(e,r){return e.replace(RegExp("(https?:\\/\\/"+r.join("\\/?[^\\s<\\\"']+)|(https?:\\/\\/")+"\\/?[^\\s<\\\"']+)","g"),function(e){return'<a href="'+e+'" target="'+(1==Comment_option.comment_urls_open?"_blank":"_self")+'">'+e+"</a>"})}function _getEntryCommentsByPaging(e){getEntryCommentsByPaging(e),comment_refresh()}function _deleteComment(e){var r="comment"+e,t="<b>수정 / 삭제된 댓글입니다. 새로고침(F5) 해주세요</b>";if(null==tistory_hi098123_comment[r])tistory_hi098123_comment[rps_finder[r]].rps[r].comm=t;else{tistory_hi098123_comment[r].comm=t;for(var _=tistory_hi098123_comment[r].rps,n=0;n<_.length;n++)_[_[n]].comm=t}deleteComment(e)}function comment_refresh(){if(""!=comment_history.node&&""!=comment_history.code)var e=100,r=100,t=!0,_=setInterval(function(){--e<1&&clearInterval(_);var n=document.querySelectorAll(comment_history.node+" script");if(n.length>0){clearInterval(_);for(var o=[],m=0;m<n.length-1;m++){var c=document.createElement("script");c.innerHTML=n[m].innerHTML+"comment_refresh_num="+m+";",document.body.appendChild(c),o.push(c)}var i=setInterval(function(){if(r--,comment_refresh_num==n.length-2||r<1)if(clearInterval(i),t&&(t=!1,tistory_hi098123_comment.sort(function(e,r){return e>r?1:e<r?-1:0})),null==tistory_hi098123_comment[tistory_hi098123_comment[tistory_hi098123_comment.length-1]].name)console.log("err"),comment_refresh();else try{hi098123_comment(comment_history.node,comment_history.code);for(var e=0;e<o.length;e++)document.body.removeChild(o[e])}catch(e){}},100)}},300)}setInterval(function(){if(""!=openWindow)try{openWindow.onbeforeunload=function(e){comment_refresh()}}catch(e){}},300);